/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var C=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var $=(e,n)=>{for(var o in n)C(e,o,{get:n[o],enumerable:!0})},B=(e,n,o,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of W(n))!S.call(e,s)&&s!==o&&C(e,s,{get:()=>n[s],enumerable:!(l=v(n,s))||l.enumerable});return e};var P=e=>B(C({},"__esModule",{value:!0}),e);var A={};$(A,{default:()=>w});module.exports=P(A);var r=require("obsidian");function I(e){let n=e.trim().match(/^\[\[([^\]|]+)(?:\|[^\]]+)?\]\]$/);return n?{linkTarget:n[1],isWikilink:!0}:{linkTarget:e,isWikilink:!1}}function M(e){let n=[],o=null,l=[],s=e.split(`
`);for(let b of s){let t=b.trim();if(t.startsWith("##")&&(t.length===2||t[2]===" "))o!==null&&n.push({heading:o,items:l}),t.length>2?o=t.substring(3).trim():o="",l=[];else if(o!==null&&(t.startsWith("- ")||t.startsWith("* "))){let i=t.substring(2).trim();l.push(i)}}return o!==null&&n.push({heading:o,items:l}),n}function x(e){return e=e.replace(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,""),e=e.replace(/^```[^\n]*$/gm,""),e=e.replace(/`/g,""),e=e.replace(/<[^>]+>/g,""),e=e.replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1"),e=e.replace(/!\[([^\]]*)\]\([^\)]+\)/g,""),e=e.replace(/^#{1,6}\s+/gm,""),e=e.replace(/^[-*+]\s+/gm,""),e=e.replace(/^\d+\.\s+/gm,""),e=e.replace(/[*_~]/g,""),e.split(/\s+/).filter(o=>o.length>0).length}var N={folderToExamine:"Sample book",finalMode:!1},w=class extends r.Plugin{async parseFiles(o,l){let s=this.app.vault,b=s.getRoot(),t=[];if(s.getAbstractFileByPath(o)instanceof r.TFolder){let c=s.getMarkdownFiles().filter(m=>m.path.startsWith(o+"/"));if(c.length===0)throw new Error(`No markdown files found in folder '${o}'`);c.sort((m,g)=>m.name.toLowerCase().localeCompare(g.name.toLowerCase())),t=c}else{let c=o;c.endsWith(".md")||(c=`${c}.md`);let m=s.getMarkdownFiles().find(g=>g.name===c||g.path===c);if(!m)throw new Error(`File '${o}' not found`);t=[m]}let a="",d="";for(let c of t){let m=await s.read(c),g=M(m);if(g.length>0){for(let{heading:V,items:T}of g)if(T.length>0)for(let p of T){(p.startsWith("[ ] ")||p.startsWith("[x] ")||p.startsWith("[X] "))&&(p=p.substring(4));let{linkTarget:f,isWikilink:y}=I(p);if(y){let F=s.getMarkdownFiles().find(h=>h.basename===f||h.name===f+".md");if(F){let h=await s.read(F);l?a+=h.trim()+`
`:(a+=`---

`,a+=`[[${f}]]

`,a+=h.trim()+`

`),d+=h+`
`}else a+=`[Link not found: ${f}]
`}else a+=p+`
`,l||(a+=`
`)}}}let u=x(d);return{output:a,wordCount:u}}async onload(){console.log("Entering onload() function1"),await this.loadSettings(),console.log("Entering onload() function");let o=this.app.vault.getMarkdownFiles();console.log("I found ",o.length," markdown files:");for(let t=0;t<o.length;t++)console.log(o[t].path);this.addRibbonIcon("book-open","Bind the files to make a book",async t=>{console.log("Book icon clicked!");try{let i=this.settings.folderToExamine||"Sample book",a=await this.parseFiles(i,this.settings.finalMode);console.log("Parse output:",a.output),console.log("Word count:",a.wordCount);let d=`${i}.md`,u=this.app.vault.getAbstractFileByPath(d),c=`Word Count: ${a.wordCount}
${a.output}`;u?await this.app.vault.modify(u,c):await this.app.vault.create(d,c)}catch(i){new r.Notice(`Error: ${i.message}`),console.error("Parse error:",i)}}).addClass("my-plugin-ribbon-class");let s=document.createElement("style");s.textContent=`
			.my-plugin-ribbon-class {
				color: #22c55e !important;
			}
		`,document.head.appendChild(s),this.addStatusBarItem().setText("Status Bar Text"),this.addCommand({id:"parse-book-folder",name:"Parse book folder",callback:async()=>{try{let t=this.settings.folderToExamine||"Sample book",i=await this.parseFiles(t,this.settings.finalMode);console.log("Parse output:",i.output),console.log("Word count:",i.wordCount);let a=`${t}.md`,d=this.app.vault.getAbstractFileByPath(a),u=`Word Count: ${i.wordCount}
${i.output}`;d?await this.app.vault.modify(d,u):await this.app.vault.create(a,u)}catch(t){new r.Notice(`Error: ${t.message}`),console.error("Parse error:",t)}}}),this.addCommand({id:"parse-book-folder-final",name:"Bind book (final)",callback:async()=>{try{new r.Notice("Binding book in final mode...");let t=this.settings.folderToExamine||"Sample book",i=await this.parseFiles(t,!0);console.log("Parse output:",i.output),console.log("Word count:",i.wordCount);let a=`${t}.md`,d=this.app.vault.getAbstractFileByPath(a),u=`Word Count: ${i.wordCount}
${i.output}`;d?await this.app.vault.modify(d,u):await this.app.vault.create(a,u)}catch(t){new r.Notice(`Error: ${t.message}`),console.error("Parse error:",t)}}}),this.addCommand({id:"open-sample-modal-simple",name:"Open sample modal (simple)",callback:()=>{new k(this.app).open()}}),this.addCommand({id:"sample-editor-command",name:"Sample editor command",editorCallback:(t,i)=>{console.log(t.getSelection()),t.replaceSelection("Sample Editor Command")}}),this.addCommand({id:"open-sample-modal-complex",name:"Open sample modal (complex)",checkCallback:t=>{if(this.app.workspace.getActiveViewOfType(r.MarkdownView))return t||new k(this.app).open(),!0}}),this.addSettingTab(new E(this.app,this)),this.registerDomEvent(document,"click",t=>{console.log("click detected",t)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3))}onunload(){}async loadSettings(){this.settings=Object.assign({},N,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},k=class extends r.Modal{constructor(n){super(n)}onOpen(){let{contentEl:n}=this;n.setText("Woah!")}onClose(){let{contentEl:n}=this;n.empty()}},E=class extends r.PluginSettingTab{constructor(o,l){super(o,l);this.plugin=l}display(){let{containerEl:o}=this;o.empty(),new r.Setting(o).setName("Folder to examine").setDesc('The folder containing markdown files to parse (e.g., "Sample book")').addText(l=>l.setPlaceholder("Sample book").setValue(this.plugin.settings.folderToExamine).onChange(async s=>{this.plugin.settings.folderToExamine=s,await this.plugin.saveSettings()})),new r.Setting(o).setName("Final mode").setDesc("When enabled, output will have no separators, links, or extra spacing").addToggle(l=>l.setValue(this.plugin.settings.finalMode).onChange(async s=>{this.plugin.settings.finalMode=s,await this.plugin.saveSettings()}))}};
